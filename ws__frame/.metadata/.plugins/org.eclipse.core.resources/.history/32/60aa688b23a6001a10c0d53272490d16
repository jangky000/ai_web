package dev.mvc.shopping_cart;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import dev.mvc.categrp.CategrpVO;


@Controller
public class Shopping_cartCont {
  
  @Autowired
  @Qualifier("dev.mvc.porder.Shopping_cartProc")
  private Shopping_cartProcInter Shopping_cartProc;

  public Shopping_cartCont() {
    System.out.println("--> Shopping_cartCont created.");
  }
  
  //http://localhost:9090/team4/shopping_cart/create.do
  /**
   * 등록 폼
   * @return
   */
  @RequestMapping(value="/shopping_cart/create.do", method=RequestMethod.GET )
  public ModelAndView create() {
    ModelAndView mav = new ModelAndView();
    mav.setViewName("/shopping_cart/create"); // webapp/shopping_cart/create.jsp
    return mav;
  }
  
 //http://localhost:9090/team4/shopping_cart/create.do
 /**
  * 등록 처리
  * @param porderVO
  * @return
  */
 @RequestMapping(value="/shopping_cart/create.do", method=RequestMethod.POST )
 public ModelAndView create(Shopping_cartVO shopping_cartVO) {
   ModelAndView mav = new ModelAndView();
   
   int cnt = this.Shopping_cartProc.create(shopping_cartVO);
   
   mav.addObject("cnt", cnt); // redirect parameter 적용
   
   mav.addObject("url", "create_msg"); // 파일명: create_msg.jsp, redirect parameter 적용
   mav.setViewName("redirect:/shopping_cart/msg.do"); // jsp파일명을 해당 주소로 파라미터 전달
   
   return mav;
 }
 
//http://localhost:9090/team4/shopping_cart/list.do
 /**
  * 주문 리스트
  * @return
  */
 @RequestMapping(value="/shopping_cart/list.do", method=RequestMethod.GET)
 public ModelAndView list(){
   ModelAndView mav = new ModelAndView();
   
   List<Shopping_cartVO> list = this.Shopping_cartProc.list();    
   mav.addObject("list", list);
   mav.setViewName("/shopping_cart/list"); // webapp/shopping_cart/list.jsp
   
   return mav; // forward
 }
 
  //http://localhost:9090/team4/shopping_cart/quantitydown.do?shopping_cartno=1
  /**
   * 장바구니 수량 하향 10 ▷ 1
   * @param shopping_cartno 장바구니 번호
   * @return
   */
  @RequestMapping(value="/shopping_cart/quantitydown.do", 
                              method=RequestMethod.GET )
  public ModelAndView quantitydown(int shopping_cartno) {
    ModelAndView mav = new ModelAndView();
    
    CategrpVO categrpVO = this.categrpProc.read(categrpno); // 카테고리 그룹 정보
    mav.addObject("categrpVO", categrpVO);  // request 객체에 저장
    
    int cnt = this.categrpProc.update_seqno_up(categrpno);  // 우선 순위 상향 처리
    mav.addObject("cnt", cnt);  // request 객체에 저장
  
    mav.setViewName("/categrp/update_seqno_up_msg"); // update_seqno_up_msg.jsp
    return mav;
  }  
 
//http://localhost:9090/team4/shopping_cart/delete.do
 /**
  * 장바구니 상품 삭제 처리, GET 방식, 세션 확인해서 삭제하기
  * @param memberVO
  * @return
  */
 @RequestMapping(value="/shopping_cart/delete.do", method=RequestMethod.GET)
 public ModelAndView delete(int shopping_cartno){
   ModelAndView mav = new ModelAndView();
   
   int cnt= Shopping_cartProc.delete(shopping_cartno);
   mav.addObject("cnt", cnt);
   mav.setViewName("redirect:/shopping_cart/list.do");
   
   return mav;
 }
 
 //http://localhost:9090/team4/shopping_cart/msg.do?
 /**
  * 메시지
  * @param url
  * @return
  */
 @RequestMapping(value="/shopping_cart/msg.do", method=RequestMethod.GET)
 public ModelAndView delete_msg(String url){
   ModelAndView mav = new ModelAndView();
   
   // 등록 처리 메시지: create_msg -> /shopping_cart/create_msg.jsp
   // 수정 처리 메시지: update_msg -> /shopping_cart/update_msg.jsp
   // 삭제 처리 메시지: delete_msg -> /shopping_cart/delete_msg.jsp
   mav.setViewName("/shopping_cart/" + url); // forward
   // cnt도 계속 get 방식 파라미터로 포워딩됨
   
   return mav; // forward
 }

 
}
