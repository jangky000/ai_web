<%@ page contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<c:set var="root" value="${pageContext.request.contextPath}" /> 

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>♥SKINFIT♥</title>
  
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="${root }/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="${root }/javascript/script.js"></script>
</head>

<body onload="showImage()">
<!-- jsp:include -> jsp가 처리되어 처리 결과가 HTML로 변경되어 메인 페이지에 포함 -->
<!-- root를 사용하기 위해 cset을 다시 선언해야 한다. -->
<jsp:include page="/menu/top.jsp" flush='false' />

  <!--컨텐츠 들어가는 부분: 여기에 각자 작업해서 업로드 하면 될듯-->
  <!-- 리스트 페이지 시작 -->
  <div style="margin: 20px auto; width: 80%;">
    로그인 시에만 접근 허용**
    
    <div>
      <h2 style="display: inline;">장바구니</h2>
      <span style="float: right;"><strong style="background-color: #ffffff;">1. 장바구니</strong> ＞ 2. 주문/결제 ＞ 3. 주문 완료</span>
    </div>
    
    <!-- 정렬 -->
    <div style="margin: 20px auto;">
      <a href="#">높은 가격순</a> | 
      <a href="#">낮은 가격순</a>
    </div>
    <!-- 정렬 종료 -->
    
    <!-- 리스트 테이블 시작 -->
    <div style="margin: 20px auto;">
      <!-- <form action="../porder/create.jsp" method="get"> -->
        <table style='width: 100%; outline: 1px solid gray;'>
            <colgroup>
              <col style="width: 5%;"></col>
              <col style="width: 20%;"></col>
              <col style="width: 25%;"></col>
              <col style="width: 10%;"></col>
              <col style="width: 10%;"></col>
              <col style="width: 10%;"></col>
              <col style="width: 10%;"></col>
              <col style="width: 10%;"></col>
            </colgroup>
            <%-- table 컬럼 --%>
            <thead>
              <tr>
                <!-- 장바구니no, 회원no, 상품no, 상품 그룹no, 상품 그룹 이름 -->
                <th style='text-align: center;'>선택</th>
                <th style='text-align: center;'>상품 이미지</th>
                <th style='text-align: center;'>상품이름</th>
                <th style='text-align: center;'>가격(할인, 쿠폰)</th>
                <th style='text-align: center;'>수량</th>
                <th style='text-align: center;'>배송비</th>
                <th style='text-align: center;'>배송일정</th>
                <th style='text-align: center;'>기타</th>
              </tr>
            
            </thead>
            
            <%-- table 내용 --%>
            <tbody>
              <% 
                String[] sample_name={"화려한 조명이 나를 감싸네 썬블록",
                                                   "시간이 멈추길 기도해 썬크림",
                                                   "불 꺼진 무대 위 홀로 남아서 자외선 차단제",
                                                   "떠나간 그대의 목소릴 떠올리네 썬블록",
                                                   "나 쓰러질 때까지 널 위해 춤을 줘 썬크림"
                                                  };
              request.setAttribute("sample_name", sample_name);
              %>
            
              <c:forEach var="shopping_cartVO" items="${list }" varStatus="sample">
                <c:set var="shopping_cartno" value="${shopping_cartVO.shopping_cartno }" />
                <c:set var="memno" value="${shopping_cartVO.memno }" />
                <c:set var="itemno" value="${shopping_cartVO.itemno }" />
                <c:set var="quantity" value="${shopping_cartVO.quantity }" />
                
                <tr>
                  <td style='text-align: center; vertical-align: middle;'><input type="checkbox" class="check_item" name="shopping_cartno" value="${shopping_cartno }"></td>
                  <td style='text-align: center;'><img src='./sample.png' style="width: 100px; height: 100px;" alt='상품 이미지'></td>
                  <td style='text-align: center; vertical-align: middle;'><a href="#">${sample_name[sample.index] }</a></td>
                  <td style='text-align: center; vertical-align: middle;'><s>100원</s>(99원)</td>
                  <td style='text-align: center; vertical-align: middle;'>
                    <button type="button" style="width: 25px;"><strong>-</strong></button>
                    <input type='text' value='${quantity }' readonly="readonly" style="width: 40px; text-align: right;">
                    <button type="button" style="width: 25px;"><strong>+</strong></button>
                  </td>
                  <td style='text-align: center; vertical-align: middle;'>2,500</td>
                  <td style='text-align: center; vertical-align: middle;'>오늘 출고</td>
                  <td style='text-align: center; vertical-align: middle;'>
                    <button type="submit" style="width: 80px;">바로 구매</button>
                    <button type="button" style="width: 80px;" onclick="location.href='./delete.do?shopping_cartno=${shopping_cartno}'">삭제</button>
                  </td>
                </tr>
              </c:forEach>
                
                
                <%-- <tr>
                  <td style='text-align: center; vertical-align: middle;'><input type="checkbox" class="check_item" name="itemno" value="2"></td>
                  <td style='text-align: center;'><img src='./sample.png' style="width: 100px; height: 100px;" alt='상품 이미지'></td>
                  <td style='text-align: center; vertical-align: middle;'><a href="#">시간이 멈추길 기도해 썬크림</a></td>
                  <td style='text-align: center; vertical-align: middle;'><s>100원</s>(99원)</td>
                  <td style='text-align: center; vertical-align: middle;'>
                    <button type="button" style="width: 25px;"><strong>-</strong></button>
                    <input type='text' value='2' readonly="readonly" style="width: 40px; text-align: right;">
                    <button type="button" style="width: 25px;"><strong>+</strong></button>
                  </td>
                  <td style='text-align: center; vertical-align: middle;'>2,500</td>
                  <td style='text-align: center; vertical-align: middle;'>내일( n일,화)</td>
                  <td style='text-align: center; vertical-align: middle;'>
                    <button type="button" onclick="location.href='./" style="width: 80px;">바로 구매</button>
                    <button type="button" style="width: 80px;" onclick="location.href='./delete.do?shopping_cartno=${shopping_cartno}'">삭제</button>
                  </td>
                </tr> --%>
              
            </tbody>
          </table>
      <!-- </form> -->
    </div>
    <!-- 리스트 테이블 종료 -->
    
    <div>
      <label><input type="checkbox" id="input_checkAll"> 전체 선택</label> &nbsp;&nbsp;&nbsp;
      <button type="button" onclick="location.href=''">삭제</button>
    </div>
    
    <div style="outline: 1px solid grey; margin: 20px auto;">
      <table style="width: 100%;">
        <colgroup>
          <col style="width: 25%;"></col>
          <col style="width: 25%;"></col>
          <col style="width: 25%;"></col>
          <col style="width: 25%;"></col>
        </colgroup>
        <thead>
          <tr>
            <th style='text-align: center;'>상품 금액(n종/n개)</th>
            <th style='text-align: center;'>배송비</th>
            <th style='text-align: center;'>쿠폰 사용</th>
            <th style='text-align: center;'>결제 예정금액</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style='text-align: center;'>100 원</td>
            <td style='text-align: center;'>2500 원</td>
            <td style='text-align: center;'>-2500 원</td>
            <td style='text-align: center;'>100 원</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div style="text-align: right;">
      <button type="button" onclick="location.href='../';">쇼핑하기</button>
      <button type="button" id="btn_porder">구매하기</button>
    </div>
  </div>
  <!-- 리스트 페이지 종료 -->
  <!--컨텐츠 들어가는 부분: 여기에 각자 작업해서 여기까지-->
  <div id="test"></div>

 <jsp:include page="/menu/bottom.jsp" flush='false' />
 
 <script type="text/javascript">
    $(function(){
      $("#input_checkAll").on("click", checkAll);
      $(".check_item").change(isCheckAll);
      $("#btn_porder").on("click", porder);
    });
    
    // 전체 선택하기
    function checkAll(){
      //alert("전체 선택");
      if($(".check_item").prop("checked"))
        $(".check_item").prop("checked", false);
      else
        $(".check_item").prop("checked", true);
    }
    
    // 체크 박스 전체 선택되었는지 확인
    function isCheckAll(){
      if($(".check_item:checked").length == $(".check_item").length)
        $("#input_checkAll").prop("checked", true);
      else
        $("#input_checkAll").prop("checked", false);
    }
    
    function porder(){
      if($("input:checkbox[name=shopping_cartno]:checked").length == 0){
        alert("상품을 1개 이상 선택해주세요.");
        return
      }
      
      //var str="";
      var form = document.createElement("form");
      form.action="../porder/test.do";
      form.method="get";
      //자식 추가
      $("body").append(form);
      
      var input;
      // 해당 조건에 맞는 태그를 각각 function 수행, for문을 사용x
      $("input:checkbox[name=shopping_cartno]:checked").each(function(){
        //str += $(this).val() + "\n"; // value 가져오기
        input = document.createElement("input");
        input.type = "hidden";
        input.name = "itemno";
        input.value = $(this).val();
        form.append(input);
      });
      //alert(str);
      form.submit();
      
      //https://sweetalert.js.org/
    }
    
  </script>
</body>
</html>